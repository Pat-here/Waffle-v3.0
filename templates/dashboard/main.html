{% extends "base.html" %}

{% block title %}Dashboard - Budka Gofrowa{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="h3 mb-3">Dashboard</h1>
            <p class="text-muted">Przegląd biznesu</p>
        </div>
    </div>

    <!-- Statystyki główne -->
    <div class="row">
        <div class="col-sm-6 col-lg-3">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col mt-0">
                            <h5 class="card-title">Produkty</h5>
                        </div>
                        <div class="col-auto">
                            <div class="stat text-primary">
                                <i class="align-middle" data-feather="package"></i>
                            </div>
                        </div>
                    </div>
                    <h1 class="mt-1 mb-3">{{ liczba_produktow }}</h1>
                </div>
            </div>
        </div>
        
        <!-- Podobne karty dla innych statystyk -->
        
        <div class="col-sm-6 col-lg-3">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col mt-0">
                            <h5 class="card-title">Kamery</h5>
                        </div>
                        <div class="col-auto">
                            <div class="stat text-info">
                                <i class="fas fa-video"></i>
                            </div>
                        </div>
                    </div>
                    <h1 class="mt-1 mb-3">{{ liczba_kamer }}</h1>
                    <div class="mb-0">
                        <a href="{{ url_for('lista_kamer') }}" class="btn btn-sm btn-outline-info">
                            <i class="fas fa-eye"></i> Podgląd
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sekcja marż -->
    <div class="row">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Średnia marża produktów</h5>
                    <h1 class="display-4 text-primary">{{ srednia_marza_produktow }}%</h1>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Średnia marża dodatków</h5>
                    <h1 class="display-4 text-success">{{ srednia_marza_dodatkow }}%</h1>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Średnia marża napojów</h5>
                    <h1 class="display-4 text-warning">{{ srednia_marza_napojow }}%</h1>
                </div>
            </div>
        </div>
    </div>

    <!-- Najbliższe dostawy -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">Najbliższe dostawy</h5>
                </div>
                <div class="card-body">
                    {% if najbliższe_dostawy %}
                    <div class="list-group list-group-flush">
                        {% for zamowienie in najbliższe_dostawy %}
                        <div class="list-group-item d-flex justify-content-between">
                            <div>
                                <strong>{{ zamowienie.dostawca }}</strong><br>
                                <small class="text-muted">{{ zamowienie.produkty[:50] }}{% if zamowienie.produkty|length > 50 %}...{% endif %}</small>
                            </div>
                            <div class="text-end">
                                {% if zamowienie.data_dostawy %}
                                    <small>{{ zamowienie.data_dostawy.strftime('%d.%m') }}</small>
                                {% else %}
                                    <small class="text-muted">TBA</small>
                                {% endif %}
                                <br>
                                <span class="badge bg-{{ 'warning' if zamowienie.status == 'oczekujace' else 'info' }}">
                                    {{ zamowienie.status }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted text-center py-3">Brak nadchodzących dostaw</p>
                    {% endif %}
                </div>
                <div class="card-footer text-center">
                    <a href="{{ url_for('lista_zamowien') }}" class="btn btn-outline-primary btn-sm">
                        Zobacz wszystkie zamówienia
                    </a>
                </div>
            </div>
        </div>

        <!-- Ostatnie raporty -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">Ostatnie raporty dzienne</h5>
                </div>
                <div class="card-body">
                    {% if ostatnie_raporty %}
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Obroty</th>
                                    <th>Zysk</th>
                                    <th>Klienci</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for raport in ostatnie_raporty %}
                                <tr>
                                    <td>{{ raport.data.strftime('%d.%m') }}</td>
                                    <td class="text-success">{{ "%.0f"|format(raport.obroty) }} zł</td>
                                    <td class="text-primary">{{ "%.0f"|format(raport.zysk) }} zł</td>
                                    <td>{{ raport.liczba_klientow }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted text-center py-3">Brak raportów dziennych</p>
                    {% endif %}
                </div>
                <div class="card-footer text-center">
                    <a href="{{ url_for('lista_raportow') }}" class="btn btn-outline-primary btn-sm">
                        Zobacz wszystkie raporty
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
